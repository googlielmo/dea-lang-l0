/*
 * SPDX-License-Identifier: MIT OR Apache-2.0
 * Copyright (c) 2025-2026 gwz
 */

module vector_string_test;

import std.io;
import std.string;
import util.vector;

func test_basic() {
    printl_s("=== Basic VectorString Test ===");
    let vs = vs_create(1);
    printl_si("Current size:", vs_size(vs));
    printl_si("Current capacity:", vs_capacity(vs));
    printl_s("Pushing strings into vector...");
    let s1 = "Hello, World!";
    let s2 = "L0 Programming Language";
    let s3 = "VectorString Test";
    let s4 = "Goodbye!";
    let s5 = "Still more strings...";
    vs_push(vs, s1);
    vs_push(vs, s2);
    vs_push(vs, s3);
    vs_push(vs, s4);
    printl_si("Current size:", vs_size(vs));
    printl_si("Current capacity:", vs_capacity(vs));
    printl_s("Pushing another string to trigger resize...");
    vs_push(vs, s5);
    printl_si("Current size:", vs_size(vs));
    printl_si("Current capacity:", vs_capacity(vs));
    printl_s("Vector contents:");
    for (let i = 0; i < vs_size(vs); i = i + 1) {
        let si = vs_get(vs, i);
        printl_is(i, si);
    }
    printl_si("Current size:", vs_size(vs));
    printl_si("Current capacity:", vs_capacity(vs));
    printl_s("Freeing vector...");
    vs_free(vs);
    printl_s("Basic test passed!\n");
}

func test_empty_vector() {
    printl_s("=== Empty VectorString Test ===");

    // Test with capacity 1
    printl_s("Creating empty vector with capacity 1...");
    let vs1 = vs_create(1);
    printl_si("  size (should be 0):", vs_size(vs1));
    printl_si("  capacity (should be 1):", vs_capacity(vs1));
    vs_free(vs1);

    // Test with larger initial capacity
    printl_s("Creating empty vector with capacity 16...");
    let vs2 = vs_create(16);
    printl_si("  size (should be 0):", vs_size(vs2));
    printl_si("  capacity (should be 16):", vs_capacity(vs2));
    vs_free(vs2);

    printl_s("Empty vector test passed!\n");
}

func test_multiple_resizes() {
    printl_s("=== Multiple Resizes Test ===");

    // Start with minimal capacity to force many resizes
    printl_s("Creating vector with capacity 1, pushing 20 strings...");
    let vs = vs_create(1);

    // Use pre-defined strings to avoid int_to_s
    vs_push(vs, "String 0");
    printl_s("  After push 1:");
    printl_si("    size:", vs_size(vs));
    printl_si("    capacity:", vs_capacity(vs));

    vs_push(vs, "String 1");
    printl_s("  After push 2:");
    printl_si("    size:", vs_size(vs));
    printl_si("    capacity:", vs_capacity(vs));

    vs_push(vs, "String 2");
    vs_push(vs, "String 3");
    printl_s("  After push 4:");
    printl_si("    size:", vs_size(vs));
    printl_si("    capacity:", vs_capacity(vs));

    // Push more to trigger resizes
    vs_push(vs, "String 4");
    vs_push(vs, "String 5");
    vs_push(vs, "String 6");
    vs_push(vs, "String 7");
    printl_s("  After push 8:");
    printl_si("    size:", vs_size(vs));
    printl_si("    capacity:", vs_capacity(vs));

    // Push 12 more strings
    vs_push(vs, "String 8");
    vs_push(vs, "String 9");
    vs_push(vs, "String 10");
    vs_push(vs, "String 11");
    vs_push(vs, "String 12");
    vs_push(vs, "String 13");
    vs_push(vs, "String 14");
    vs_push(vs, "String 15");
    printl_s("  After push 16:");
    printl_si("    size:", vs_size(vs));
    printl_si("    capacity:", vs_capacity(vs));

    vs_push(vs, "String 16");
    vs_push(vs, "String 17");
    vs_push(vs, "String 18");
    vs_push(vs, "String 19");

    printl_s("Final vector state:");
    printl_si("  size:", vs_size(vs));
    printl_si("  capacity:", vs_capacity(vs));

    // Verify first and last elements
    printl_ss("  First element:", vs_get(vs, 0));
    printl_ss("  Last element:", vs_get(vs, 19));

    vs_free(vs);
    printl_s("Multiple resizes test passed!\n");
}

func test_single_element() {
    printl_s("=== Single Element Test ===");

    let vs = vs_create(1);
    printl_s("Pushing single element...");
    vs_push(vs, "Only one");

    printl_si("  size:", vs_size(vs));
    printl_si("  capacity:", vs_capacity(vs));
    printl_ss("  element:", vs_get(vs, 0));

    vs_free(vs);
    printl_s("Single element test passed!\n");
}

func main() {
    printl_s("==========================================");
    printl_s("       VectorString Test Suite");
    printl_s("==========================================\n");

    test_basic();
    test_empty_vector();
    test_multiple_resizes();
    test_single_element();

    printl_s("==========================================");
    printl_s("   All VectorString tests passed!");
    printl_s("==========================================");
}
